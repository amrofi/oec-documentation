<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>OEC Documentation</title>
  <meta name="description" content="OEC Documentation">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="OEC Documentation" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://pachamaltese/recursive-solutions/" />
  
  
  <meta name="github-repo" content="pachamaltese/recursive-solutions" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="OEC Documentation" />
  
  
  

<meta name="author" content="Pachá (Mauricio Vargas Sepúlveda)">


<meta name="date" content="2018-07-27">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="data-availability.html">
<link rel="next" href="the-mathematics-of-economic-complexity.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Table of Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>A simple documentation</a></li>
<li class="chapter" data-level="1" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>1</b> Data Sources</a></li>
<li class="chapter" data-level="2" data-path="data-availability.html"><a href="data-availability.html"><i class="fa fa-check"></i><b>2</b> Data Availability</a><ul>
<li class="chapter" data-level="2.1" data-path="data-availability.html"><a href="data-availability.html#yearly-data"><i class="fa fa-check"></i><b>2.1</b> Yearly data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-processing.html"><a href="data-processing.html"><i class="fa fa-check"></i><b>3</b> Data Processing</a><ul>
<li class="chapter" data-level="3.1" data-path="data-processing.html"><a href="data-processing.html#tidy-data"><i class="fa fa-check"></i><b>3.1</b> Tidy Data</a></li>
<li class="chapter" data-level="3.2" data-path="data-processing.html"><a href="data-processing.html#filling-gaps-in-our-data"><i class="fa fa-check"></i><b>3.2</b> Filling gaps in our data</a></li>
<li class="chapter" data-level="3.3" data-path="data-processing.html"><a href="data-processing.html#countries-not-included-in-rankings-and-indicators"><i class="fa fa-check"></i><b>3.3</b> Countries not included in rankings and indicators</a></li>
<li class="chapter" data-level="3.4" data-path="data-processing.html"><a href="data-processing.html#github-repositories"><i class="fa fa-check"></i><b>3.4</b> GitHub repositories</a><ul>
<li class="chapter" data-level="3.4.1" data-path="data-processing.html"><a href="data-processing.html#getting-and-cleaning-data-from-un-comtrade"><i class="fa fa-check"></i><b>3.4.1</b> Getting and cleaning data from UN COMTRADE</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-processing.html"><a href="data-processing.html#scraping-data-in-the-atlas-of-economic-complexity"><i class="fa fa-check"></i><b>3.4.2</b> Scraping data in The Atlas of Economic Complexity</a></li>
<li class="chapter" data-level="3.4.3" data-path="data-processing.html"><a href="data-processing.html#product-space-layouts"><i class="fa fa-check"></i><b>3.4.3</b> Product space layouts</a></li>
<li class="chapter" data-level="3.4.4" data-path="data-processing.html"><a href="data-processing.html#product-and-country-codes"><i class="fa fa-check"></i><b>3.4.4</b> Product and country codes</a></li>
<li class="chapter" data-level="3.4.5" data-path="data-processing.html"><a href="data-processing.html#r-packages-for-reproducibility"><i class="fa fa-check"></i><b>3.4.5</b> R packages (for reproducibility)</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="data-processing.html"><a href="data-processing.html#software-versions"><i class="fa fa-check"></i><b>3.5</b> Software versions</a></li>
<li class="chapter" data-level="3.6" data-path="data-processing.html"><a href="data-processing.html#hardware-information"><i class="fa fa-check"></i><b>3.6</b> Hardware information</a></li>
<li class="chapter" data-level="3.7" data-path="data-processing.html"><a href="data-processing.html#reproducibility-notes"><i class="fa fa-check"></i><b>3.7</b> Reproducibility notes</a></li>
<li class="chapter" data-level="3.8" data-path="data-processing.html"><a href="data-processing.html#coding-style-and-performant-code"><i class="fa fa-check"></i><b>3.8</b> Coding style and performant code</a></li>
<li class="chapter" data-level="3.9" data-path="data-processing.html"><a href="data-processing.html#materials-of-interest"><i class="fa fa-check"></i><b>3.9</b> Materials of interest</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html"><i class="fa fa-check"></i><b>4</b> The Mathematics of Economic Complexity</a><ul>
<li class="chapter" data-level="4.1" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html#revealed-comparative-advantage-rca"><i class="fa fa-check"></i><b>4.1</b> Revealed Comparative Advantage (RCA)</a></li>
<li class="chapter" data-level="4.2" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html#smooth-revealed-comparative-advantage-srca"><i class="fa fa-check"></i><b>4.2</b> Smooth Revealed Comparative Advantage (SRCA)</a></li>
<li class="chapter" data-level="4.3" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html#diversity-and-ubiquity"><i class="fa fa-check"></i><b>4.3</b> Diversity and Ubiquity</a></li>
<li class="chapter" data-level="4.4" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html#reflections-method"><i class="fa fa-check"></i><b>4.4</b> Reflections Method</a></li>
<li class="chapter" data-level="4.5" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html#economic-complexity-index-eci"><i class="fa fa-check"></i><b>4.5</b> Economic Complexity Index (ECI)</a></li>
<li class="chapter" data-level="4.6" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html#product-complexity-index-pci"><i class="fa fa-check"></i><b>4.6</b> Product Complexity Index (PCI)</a></li>
<li class="chapter" data-level="4.7" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html#product-proximity"><i class="fa fa-check"></i><b>4.7</b> Product Proximity</a></li>
<li class="chapter" data-level="4.8" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html#country-proximity"><i class="fa fa-check"></i><b>4.8</b> Country Proximity</a></li>
<li class="chapter" data-level="4.9" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html#product-density"><i class="fa fa-check"></i><b>4.9</b> Product Density</a></li>
<li class="chapter" data-level="4.10" data-path="the-mathematics-of-economic-complexity.html"><a href="the-mathematics-of-economic-complexity.html#country-density"><i class="fa fa-check"></i><b>4.10</b> Country Density</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>5</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OEC Documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-processing" class="section level1">
<h1><span class="header-section-number">Section 3</span> Data Processing</h1>
<div id="tidy-data" class="section level2">
<h2><span class="header-section-number">3.1</span> Tidy Data</h2>
<p>I followed Tidy Data principles. Those principles are closely tied to those of relational databases and Codd’s relational algebra. I only followed the principles exposed in <span class="citation">[<a href="#ref-tidydata2014">2</a>]</span> and <span class="citation">[<a href="#ref-r4ds2016">3</a>]</span> above all matters related to performing code and coding style.</p>
<div class="figure"><span id="fig:unnamed-chunk-1"></span>
<img src="fig/tidy-data.svg" alt="Data pipeline"  />
<p class="caption">
Figure 3.1: Data pipeline
</p>
</div>
</div>
<div id="filling-gaps-in-our-data" class="section level2">
<h2><span class="header-section-number">3.2</span> Filling gaps in our data</h2>
<p>I use mirrored flows to cover gaps in raw data. Some countries report zero exports for some products, but I can inspect what their trade partners reported. If country A reported zero exports (imports) of product B to (from) country C, then I searched what country C reported of imports (exports) of product B from (to) country A.</p>
<p>This approach has one major drawback and is that exports are reported FOB (free on board) while imports are reported CIF (cost, insurance and freight). There are different approaches to solve this difficulty, and in particular <span class="citation">[<a href="#ref-tradecosts2004">4</a>]</span>, <span class="citation">[<a href="#ref-geography2009">5</a>]</span> and <span class="citation">[<a href="#ref-baci2010">6</a>]</span> discuss this in detail and propose that an 8% CIF/FOB ratio is suitable to discount costs and compare imports and exports.</p>
<p>Let <span class="math inline">\(x_{c,c&#39;,p}\)</span> represent the exports of country <span class="math inline">\(c\)</span> to country <span class="math inline">\(c&#39;\)</span> in product <span class="math inline">\(p\)</span> and <span class="math inline">\(m_{c&#39;,c,p}\)</span> the imports of country <span class="math inline">\(c&#39;\)</span> from country <span class="math inline">\(c\)</span>. Under this notation I defined corrected flows as:</p>
<p><span class="math display">\[\hat{x}_{c,c&#39;,p} = \max\left\{x_{c,c&#39;,p}, \frac{m_{c&#39;,c,p}}{1.08}\right\}\]</span> <span class="math display">\[\hat{m}_{c,c&#39;,p} = \max\left\{x_{c&#39;,c,p}, \frac{m_{c,c&#39;,p}}{1.08}\right\}\]</span></p>
<p>After symmetrization all observations are rounded to zero decimals.</p>
<!--
## Classification conversion in monthly data

As [UN COMTRADE](https://comtrade.un.org/data/) states: "Monthly datasets may mix codes from multiple HS revisions and are provided as is except for standardization of trade flow and partner information, as well as conversion to US dollars."

Our solution to obtain tidy datasets was to convert all HS codes available in raw datasets to HS rev 2007. In \@ref(materials-of-interest) I provide links to correspondence tables that allow us to do that conversion process.
-->
</div>
<div id="countries-not-included-in-rankings-and-indicators" class="section level2">
<h2><span class="header-section-number">3.3</span> Countries not included in rankings and indicators</h2>
<p>The curated data includes all the countries available from UN Comtrade data. However, RCA based calculations such as ECI, PCI, Proximity and Density explained in Chapter <a href="the-mathematics-of-economic-complexity.html#the-mathematics-of-economic-complexity">4</a> consider 128 countries that account for 99% of world trade, 97% of the world’s total GDP and 95% of the world’s population according to <span class="citation">[<a href="#ref-atlas2014">7</a>]</span>.</p>
<p>I considered simultaneously:</p>
<ul>
<li>Countries with population greater or equal to 1.2 million</li>
<li>Countries whose traded value is greater or equal than 1 billion</li>
</ul>
<div class="figure"><span id="fig:unnamed-chunk-2"></span>
<img src="fig/countries.svg" alt="Schematic of the procedure used to determine the countries that were included in the Atlas"  />
<p class="caption">
Figure 3.2: Schematic of the procedure used to determine the countries that were included in the Atlas
</p>
</div>
</div>
<div id="github-repositories" class="section level2">
<h2><span class="header-section-number">3.4</span> GitHub repositories</h2>
<div id="getting-and-cleaning-data-from-un-comtrade" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Getting and cleaning data from UN COMTRADE</h3>
<ul>
<li><a href="https://github.com/pachamaltese/oec-yearly-datasets">OEC Yearly Data</a></li>
<li><a href="https://github.com/pachamaltese/oec-monthly-datasets">OEC Monthly Data</a></li>
</ul>
</div>
<div id="scraping-data-in-the-atlas-of-economic-complexity" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Scraping data in The Atlas of Economic Complexity</h3>
<ul>
<li><a href="https://github.com/pachamaltese/oec-atlas-data">OEC Atlas Data</a></li>
</ul>
</div>
<div id="product-space-layouts" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Product space layouts</h3>
<ul>
<li><a href="https://github.com/pachamaltese/oec-product-space">OEC Product Space</a></li>
</ul>
</div>
<div id="product-and-country-codes" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Product and country codes</h3>
<ul>
<li><a href="https://github.com/pachamaltese/oec-observatory-codes">OEC Observatory Codes</a></li>
<li><a href="https://github.com/pachamaltese/oec-comtrade-codes">OEC Comtrade Codes</a></li>
</ul>
</div>
<div id="r-packages-for-reproducibility" class="section level3">
<h3><span class="header-section-number">3.4.5</span> R packages (for reproducibility)</h3>
<ul>
<li><a href="https://github.com/pachamaltese/oec-packages-snapshot/">Packrat snapshot</a></li>
<li><a href="https://github.com/pachamaltese/oec-bundles">Packrat bundles</a></li>
</ul>
</div>
</div>
<div id="software-versions" class="section level2">
<h2><span class="header-section-number">3.5</span> Software versions</h2>
<p>At the moment I am using R 3.4.3 and RStudio Server Pro 1.1 on Ubuntu Server 16.04.</p>
<p>I built R from binaries in order to obtain a setup linked with multi-threaded BLAS/LAPACK libraries. This build is linked to Intel MKL 2017 but my output can be reproduced if your R setup is linked to OpenBLAS, only performance differences should be noticed for some hardware.</p>
</div>
<div id="hardware-information" class="section level2">
<h2><span class="header-section-number">3.6</span> Hardware information</h2>
<p>Our server features Intel© Xeon 2.27GHz (eight cores) processor and 32 GB (four DDR3 cards of eight gigabytes each).</p>
<p>The functions are executed using parallelization on four cores because empirically I detected and overhead due to data communication with the cores when using more cores.</p>
<p>Please notice that running our scripts with parallelization demands more RAM than the amount you can find on an average laptop.</p>
</div>
<div id="reproducibility-notes" class="section level2">
<h2><span class="header-section-number">3.7</span> Reproducibility notes</h2>
<p>To guarantee reproducibility I provided <a href="https://rstudio.github.io/packrat/">Packrat</a> snapshot and bundles. This prevents changes in syntax, functions or dependencies.</p>
<p>My R installation is isolated from apt-get to avoid any accidental updates that can alter the data pipeline and/or the output.</p>
<p>The projects are related to each other. In order to avoid multiple copies of files some projects read files from other projects. For example, <a href="https://github.com/pachamaltese/oec-yearly-indicators">OEC Yearly Indicators</a> input is the output of <a href="https://github.com/pachamaltese/oec-yearly-datasets">OEC Yearly Datasets</a> and <a href="https://github.com/pachamaltese/oec-atlas-data">OEC Atlas Data</a>.</p>
<p>The only reproducibility flaw of this project lies in data downloading. Obtaining raw datasets from UN COMTRADE demands an API key that can only be obtained from institutional access.</p>
<p>This project will not work on Windows without editing parts of the code. Multicore functionality supports multiple workers only on those operating systems that support the fork system call, and this excludes Windows.</p>
</div>
<div id="coding-style-and-performant-code" class="section level2">
<h2><span class="header-section-number">3.8</span> Coding style and performant code</h2>
<p>I used <a href="http://style.tidyverse.org/">Tidyverse Style Guide</a>. As cornerstone references for performant code I followed <span class="citation">[<a href="#ref-advancedr2014">8</a>]</span> and <span class="citation">[<a href="#ref-masteringsoftware2017">9</a>]</span>.</p>
<p>Some matrix operations are written in Rcpp to take advantage of C++ speed. To take full advantage of hardware and numerical libraries I am using sparse matrices as it is explained in <span class="citation">[<a href="#ref-rcpparmadillo2018">10</a>]</span>.</p>
</div>
<div id="materials-of-interest" class="section level2">
<h2><span class="header-section-number">3.9</span> Materials of interest</h2>
<ul>
<li><a href="https://github.com/pachamaltese/oec-atlas-data/tree/master/2-scraped-tables">Rankings from the Atlas (scraped from the original PDF)</a></li>
<li><a href="https://github.com/pachamaltese/oec-comtrade-codes/blob/master/country-codes.xls?raw=true">Country names with equivalency between UN numeric code, ISO 2 and ISO 3 (UN COMTRADE)</a></li>
<li><a href="https://github.com/pachamaltese/oec-comtrade-codes/blob/master/official-list-of-comtrade-codes.xlsx?raw=true">UN COMTRADE product classifications</a></li>
<li><a href="https://github.com/pachamaltese/oec-product-space/tree/master/hs92-sitc/2-layouts-d3plus1">Layouts to visualize the product space</a></li>
<li><a href="https://github.com/pachamaltese/oec-product-space/tree/master/hs92-sitc/3-layouts-d3plus2">Layouts to visualize the product space (for D3plus 2)</a></li>
</ul>
<p>UN COMTRADE product classifications may be of interest as it includes all trade classifications levels with detailed description of: (i) Harmonized System revisions 1992 (H0/HS92), 1996 (H1), 2002 (H2), 2007 (H3), 2012 (H4), 2017 (H5); Standard International Trade classification revisions 1 (S1), 2 (S2), 3 (S3), (iii) and 4 (S4); and Broad Economic Categories (BE).</p>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-tidydata2014">
<p>[2] H. Wickham, “Tidy data,” <em>Journal of Statistical Software, Articles</em>, vol. 59, no. 10, pp. 1–23, 2014.</p>
</div>
<div id="ref-r4ds2016">
<p>[3] H. Wickham and G. Grolemund, <em>R for data science: Import, tidy, transform, visualize, and model data</em>. O’Reilly Media, Inc., 2016.</p>
</div>
<div id="ref-tradecosts2004">
<p>[4] J. E. Anderson and E. Van Wincoop, “Trade costs,” <em>Journal of Economic literature</em>, vol. 42, no. 3, pp. 691–751, 2004.</p>
</div>
<div id="ref-geography2009">
<p>[5] D. Hummels, “Toward a geography of trade costs,” 1999.</p>
</div>
<div id="ref-baci2010">
<p>[6] G. Gaulier and S. Zignago, “Baci: International trade database at the product-level (the 1994-2007 version),” 2010.</p>
</div>
<div id="ref-atlas2014">
<p>[7] C. Hidalgo, R. Hausmann, S. Bustos, M. Coscia, A. Simoes, and M. Yildirim, <em>The atlas of economic complexity: Mapping paths to prosperity</em>. Mit Press, 2014.</p>
</div>
<div id="ref-advancedr2014">
<p>[8] H. Wickham, <em>Advanced r</em>. CRC Press, 2014.</p>
</div>
<div id="ref-masteringsoftware2017">
<p>[9] R. Peng, S. Kross, and B. Anderson, <em>Mastering software development in R</em>. Leanpub, 2017.</p>
</div>
<div id="ref-rcpparmadillo2018">
<p>[10] B. Ni, D. Selivanov, D. Eddelbuettel, and Q. Kou, “RcppArmadillo: Sparse matrix support,” Comprehensive R Archive Network, 2018.</p>
</div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65764144-13', 'auto');
  ga('send', 'pageview');
</script>
            </section>

          </div>
        </div>
      </div>
<a href="data-availability.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-mathematics-of-economic-complexity.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
